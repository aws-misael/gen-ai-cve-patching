import json
import requests
import os
import time  # Import the time module

def lambda_handler(event, context):
    ecr_repo_name = (event.get('detail').get('repository-name')).split("/")[1]
    gen_ai_service_api = os.getenv("ECS_SERVICE_API", "")

    # Sleep for 100 seconds
    time.sleep(100)  # Add the sleep here if you want the delay before the request

    # Define the header as 'Content-Type': 'application/json'
    headers = {
        'Content-Type': 'application/json'
    }
    
    response = requests.post(
        f"{gen_ai_service_api}/analyze",
        headers=headers,
        json={"ecr_repo_name": ecr_repo_name}
    )
    
    # Check if the request was successful
    if response.status_code == 200:
        return {
            'statusCode': 200,
            'body': json.dumps('Request to analyze service was successful.')
        }
    else:
        return {
            'statusCode': response.status_code,
            'body': json.dumps('Request to analyze service failed.')
        }
